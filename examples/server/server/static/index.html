<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebAuthn FIDO2 Test Application</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <h1>WebAuthn FIDO2 Test Application</h1>
        <p>Complete testing suite for WebAuthn authentication with simple and advanced options</p>
    </div>

    <div class="container">
        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('simple')">Simple Authentication</button>
            <button class="nav-tab" onclick="switchTab('advanced')">Advanced Authentication</button>
            <button class="nav-tab" onclick="switchTab('decoder')">Decoder</button>
        </nav>

        <div class="content">
            <!-- Simple Authentication Tab -->
            <div id="simple-tab" class="tab-content active">
                <div class="section">
                    <h2>Simple Authentication</h2>
                    <p>Basic WebAuthn operations with minimal configuration - same functionality as the original demo.</p>
                    
                    <div class="status" id="simple-status"></div>

                    <div class="form-group">
                        <label for="simple-email">Email (User Identifier)</label>
                        <input type="email" id="simple-email" class="form-control" placeholder="Enter your email">
                    </div>

                    <div class="form-group">
                        <button class="btn" onclick="simpleRegister()">Register Passkey</button>
                        <button class="btn btn-secondary" onclick="simpleAuthenticate()">Authenticate</button>
                    </div>

                    <div class="progress" id="simple-progress">
                        <div class="spinner"></div>
                        <span id="simple-progress-text">Processing...</span>
                    </div>

                    <!-- Credentials List -->
                    <div class="section">
                        <h3>Registered Credentials</h3>
                        <div id="credentials-list">
                            <!-- Credentials will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Authentication Tab -->
            <div id="advanced-tab" class="tab-content">
                <div class="section">
                    <h2>Advanced Authentication</h2>
                    <p>Comprehensive WebAuthn configuration with full control over registration and assertion options.</p>
                    
                    <div class="status" id="advanced-status"></div>

                    <div class="alert alert-info">
                        <strong>Coming Soon:</strong> Full advanced authentication functionality with comprehensive WebAuthn options including:
                        <ul style="margin-top: 0.5rem; margin-bottom: 0;">
                            <li>User Identity configuration (User ID, Display Name)</li>
                            <li>Authenticator Selection (Platform, Cross-platform, Resident Keys)</li>
                            <li>Extensions (credProps, minPinLength, largeBlob, PRF)</li>
                            <li>JSON Editor for real-time option visualization</li>
                            <li>Credential management and advanced debugging tools</li>
                        </ul>
                    </div>

                    <div class="form-group">
                        <button class="btn" onclick="advancedRegister()">Advanced Register (Coming Soon)</button>
                        <button class="btn btn-secondary" onclick="advancedAuthenticate()">Advanced Authenticate (Coming Soon)</button>
                    </div>

                    <!-- Advanced Credentials List -->
                    <div class="section">
                        <h3>Advanced Credentials</h3>
                        <div id="advanced-credentials-list">
                            <!-- Advanced credentials will be displayed here -->
                        </div>
                    </div>

                    <div class="progress" id="advanced-progress">
                        <div class="spinner"></div>
                        <span id="advanced-progress-text">Processing...</span>
                    </div>
                </div>
            </div>

            <!-- Decoder Tab -->
            <div id="decoder-tab" class="tab-content">
                <div class="section">
                    <h2>WebAuthn Response Decoder</h2>
                    <p>Decode and analyze WebAuthn authentication responses, credential data, and attestation objects.</p>
                    
                    <div class="status" id="decoder-status"></div>

                    <div class="form-group">
                        <label for="decoder-input">Paste WebAuthn Response JSON</label>
                        <textarea id="decoder-input" class="form-control" rows="10" placeholder="Paste your WebAuthn registration or authentication response here..."></textarea>
                    </div>

                    <div class="form-group">
                        <button class="btn" onclick="decodeResponse()">Decode Response</button>
                        <button class="btn btn-secondary" onclick="clearDecoder()">Clear</button>
                    </div>

                    <div id="decoder-output" style="display: none;">
                        <h3>Decoded Information</h3>
                        <div id="decoded-content" class="json-editor">
                            <!-- Decoded output will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script type="module">
        import {
            create,
            get,
            parseCreationOptionsFromJSON,
            parseRequestOptionsFromJSON,
        } from '/webauthn-json.browser-ponyfill.js';

        // Make functions globally available
        window.create = create;
        window.get = get;
        window.parseCreationOptionsFromJSON = parseCreationOptionsFromJSON;
        window.parseRequestOptionsFromJSON = parseRequestOptionsFromJSON;
    </script>

    <!-- Load application modules -->
    <script src="app.js"></script>
    <script src="simple-auth.js"></script>
    <script src="advanced-auth.js"></script>
    <script src="decoder.js"></script>

    <script>
        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize default tab
            switchTab('simple');
            
            // Initialize credentials lists
            updateCredentialsList();
            updateCredentialsDisplay();
        });
    </script>
</body>
</html>