# WebAuthn FIDO2 Test Application With PQC Support

A test server and web UI for WebAuthn/FIDO2 registration and authentication.  
It displays the selected algorithm, authenticator flags (UP/UV/AT/ED/BE/BS), sign counter, and extension results (credProps, PRF, largeBlob) for validation.  
This test app also supports functionalities such as **decoder**, **FIDO MDS explorer**, etc.  

Built on **python-fido2-PQC**, which extends Yubico‚Äôs **python-fido2**.  
Classical algorithms work by default.

---

## üíª Local Setup

This guide shows how to clone the repository and set up a working local environment for WebAuthn with Python FIDO2 on **Windows** and **macOS**.

**Scope**
- Includes: Python, virtual environment, Flask, python-fido2, and Post-Quantum Crypto (PQC) algorithm options.

---

## ‚úÖ Supported Platforms

- Windows 10/11 (64-bit)  
- macOS (Intel or Apple Silicon)  

A modern browser with WebAuthn support is required:
- Edge, Chrome, Safari, Firefox

---

## 1. Prerequisites

- **Git**: [git-scm.com](https://git-scm.com/)  
- **Python 3.12+ (64-bit)** with pip  
  - **Windows**: Install from [python.org](https://www.python.org/downloads/windows/) and check *‚ÄúAdd Python to PATH.‚Äù*  
  - **macOS**: Install via [python.org](https://www.python.org/downloads/macos/) or Homebrew.

---

## 2. Clone the Repository

```bash
git clone https://github.com/rainzhang05/python-fido2-webauthn-test.git
cd python-fido2-webauthn-test
```

---

## 3. Recommended Setup ‚Äî pip + venv

### Windows (PowerShell)

```powershell
# Create and activate a virtual environment
py -3.12 -m venv .venv
.\.venv\scripts\activate

# Upgrade pip and install runtime dependencies
python -m pip install --upgrade pip
pip install fido2 flask cryptography cbor2

# Optional: PC/SC smart card extras
pip install "fido2[pcsc]"
```

### macOS

```bash
# Create and activate a virtual environment
python3 -m venv .venv
source .venv/bin/activate

# Upgrade pip and install runtime dependencies
python -m pip install --upgrade pip
pip install fido2 flask cryptography cbor2

# Optional: PC/SC smart card extras
pip install "fido2[pcsc]"
```

---

## 4. Optional Setup ‚Äî Poetry (instead of pip/venv)

Use **Poetry** if you prefer its workflow. It will create `.venv` inside the project.

### Install Poetry

#### Windows (PowerShell)

```powershell
# Install pipx for isolated CLI apps
py -3.12 -m pip install --user pipx
py -3.12 -m pipx ensurepath
# Open a NEW PowerShell window so PATH changes apply

# Install Poetry via pipx
pipx install poetry
```

#### macOS

```bash
python3 -m pip install --user pipx
python3 -m pipx ensurepath
# Open a new terminal
pipx install poetry
poetry --version
```

### Use Poetry in this Project

```bash
# From the repo root
poetry config virtualenvs.in-project true

# Point Poetry to your Python
poetry env use 3.12
# OR specify absolute path if needed:
# poetry env use "/usr/bin/python3"                # macOS example
# poetry env use "C:\Path\To\Python312\python.exe" # Windows example

poetry install
```

---

## 5. Install and Use Pytest

Pytest is used for running unit tests.

### pip + venv
```bash
pip install --upgrade pip
pip install pytest
pytest
```

### Poetry
```bash
poetry add --group dev pytest
poetry run pytest
```

---

## üîê PQC Setup

### 1. Activate Your Python Virtual Environment

**Windows (PowerShell):**
```powershell
.\.venv\Scripts\Activate
```

**macOS:**
```bash
source .venv/bin/activate
```

### 2. Install PQC Cryptography Libraries

**Using pip / virtualenv**
```bash
pip install ".[pqc]"
python -c "import oqs"
```

**Using Poetry**
```bash
poetry install --with pqc
poetry run python -c "import oqs"
```

---

## üîí mkcert Setup for Local HTTPS

### 1. Install mkcert

#### Windows
1. Download the latest `mkcert.exe`:  
   üëâ [GitHub Releases](https://github.com/FiloSottile/mkcert/releases)  
2. Place `mkcert.exe` in a folder included in **PATH** (e.g., `C:\Windows\System32`).  
3. Run in PowerShell:
   ```powershell
   mkcert -install
   ```

#### macOS
```bash
brew install mkcert
brew install nss   # required for Firefox users
mkcert -install
```

---

### 2. Generate Certificates

**Windows (PowerShell)**
```powershell
cd C:\path\to\your\project
mkcert localhost 127.0.0.1 ::1
```

**macOS (Terminal)**
```bash
cd /path/to/your/project
mkcert localhost 127.0.0.1 ::1
```

‚ö†Ô∏è Important:
- WebAuthn works on `localhost`, **not** `127.0.0.1`.  
- Rename files to:
  - `localhost+1.pem`  
  - `localhost+1-key.pem`  
  Otherwise, the program will fail to run.

---

## üöÄ Quickstart

### 1. Create and Activate Virtual Environment

**Windows (PowerShell)**
```powershell
py -3 -m venv .venv
.\.venv\Scripts\Activate.ps1
```

**macOS**
```bash
python3 -m venv .venv
source .venv/bin/activate
```

---

### 2. Install Dependencies

```bash
python -m pip install --upgrade pip
pip install flask fido2
```

---

### 3. Run the Demo Server

```bash
python examples/server/server/app.py
```

Expected output:
```
Running on https://localhost:5000/
```

Click the link to open the test app in your browser.

---

## üìù Notes

- Credentials are saved as `.pkl` files in:  
  `examples/server/server`  
- Deleting credentials in the test app will also delete the corresponding `.pkl` file locally.

---
